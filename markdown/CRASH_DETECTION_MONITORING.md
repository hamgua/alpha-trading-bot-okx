# 暴跌检测改进后监控指南

## 关键指标监控

### 1. 暴跌检测日志
- 日志关键词: "检测到", "暴跌事件", "CRITICAL", "HIGH"
- 监控命令: `grep -i "crash\|暴跌" logs/alpha-trading-bot-okx-*.log`

### 2. 检测频率统计
```bash
# 统计每小时检测到的暴跌事件
grep "检测到.*暴跌事件" logs/alpha-trading-bot-okx-*.log | awk '{print $1}' | cut -d' ' -f2 | cut -d':' -f1 | sort | uniq -c
```

### 3. 信号生成统计
```bash
# 统计暴跌相关的交易信号
grep -E "source.*crash_detection|市场情绪消极" logs/alpha-trading-bot-okx-*.log | wc -l
```

## 告警设置

### 1. 严重暴跌告警（立即通知）
当检测到 CRITICAL 级别暴跌时，立即发送告警

### 2. 高频暴跌告警（1小时内多次）
当1小时内检测到3次以上暴跌事件时，发送告警

### 3. 连续下跌告警
当检测到连续下跌信号时，发送预警

## 性能监控

### 1. 检测延迟
监控从价格变化到检测出的时间延迟，应小于30秒

### 2. 误报率
统计暴跌信号中实际价格下跌的比例

### 3. 漏报率
监控实际暴跌但未触发检测的情况

## 故障排查

### 常见问题1: 检测器未触发
- 检查数据质量：查看是否有"数据验证失败"日志
- 检查阈值设置：确认币种特异性参数是否正确
- 检查价格历史：确认是否有足够的历史数据

### 常见问题2: 误报过多
- 调整检测阈值
- 检查数据源质量
- 考虑调整时间框架权重

### 常见问题3: 响应延迟
- 检查系统负载
- 优化价格数据更新频率
- 考虑使用异步处理

## 回测验证

建议定期进行历史数据回测，验证检测效果：

```bash
# 运行回测脚本
python3 backtest_crash_detection.py --period 30d --symbol BTC/USDT
```

## 联系支持

如遇到问题，请提供以下信息：
1. 相关日志片段
2. 检测器配置
3. 价格数据样本
4. 预期行为vs实际行为

## 配置调优建议

### 1. 根据市场波动性调整
- 高波动期（如重大事件）：提高阈值
- 低波动期：降低阈值以提高敏感度

### 2. 币种特异性配置
- BTC：使用默认阈值
- ETH：阈值提高20%
- 小币种：阈值提高50-100%

### 3. 时间框架选择
- 短线交易：重点关注15m-1h
- 中长线：重点关注1h-4h
- 日内交易：所有时间框架

## 日志分析示例

### 正常检测日志
```
[2025-12-18 10:30:15] 检测到 2 个暴跌事件: ['medium', 'high']
[2025-12-18 10:30:15]   - 1h: -3.33% (阈值: 2.50%)
[2025-12-18 10:30:15]   - acceleration: -3.37% (阈值: 1.50%)
```

### 数据异常日志
```
[2025-12-18 10:30:15] 数据验证失败: 成交量过低: 0.0
[2025-12-18 10:30:15] 数据验证失败: 价格数据过期
```

### 信号生成日志
```
[2025-12-18 10:30:16] 暴跌检测完成: 发现 2 个暴跌事件
[2025-12-18 10:30:16] 生成信号: SELL (信心: 0.8, 来源: crash_detection)
```

## 性能指标

### 检测准确率目标
- 严重暴跌（>5%）：检测率 > 95%
- 中度暴跌（3-5%）：检测率 > 85%
- 轻度暴跌（1.5-3%）：检测率 > 70%

### 响应时间目标
- 检测延迟：< 30秒
- 信号生成：< 60秒
- 订单执行：< 120秒

### 误报率目标
- 日误报次数：< 3次
- 周误报率：< 10%

## 定期维护

### 每日检查
- 检查前24小时检测日志
- 统计误报/漏报情况
- 验证数据质量

### 每周检查
- 分析检测效果
- 调整阈值参数
- 更新币种特异性配置

### 每月检查
- 完整性能评估
- 回测历史数据
- 优化检测算法