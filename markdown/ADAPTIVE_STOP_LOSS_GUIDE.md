# 自适应止损功能使用指南

## 🎯 功能概述

自适应止损是一种智能止损策略，能够根据市场趋势自动调整止损百分比：

- **上升趋势**（价格 > 入场价）：使用较小的止损百分比（如2%），锁定更多利润
- **下降趋势**（价格 ≤ 入场价）：使用较大的止损百分比（如4%），给震荡留出空间

## 📋 核心特性

1. **趋势感知**：自动识别上升/下降趋势
2. **只涨不跌**：止损价格一旦上移，不会回调
3. **多空支持**：支持多头和空头仓位的自适应逻辑
4. **向后兼容**：可关闭自适应功能，回退到传统止损

## ⚙️ 配置说明

在 `.env` 文件中添加以下配置：

```bash
# 自适应止损配置
ADAPTIVE_STOP_LOSS_ENABLED=true     # 是否启用自适应止损
UP_TREND_STOP_LOSS=0.02             # 上升趋势止损百分比（2%）
DOWN_TREND_STOP_LOSS=0.04           # 下降趋势止损百分比（4%）
```

## 🔧 使用示例

### 场景1：上升趋势
- 入场价：$85,000
- 当前价：$87,000（上涨）
- 使用止损：2%
- 止损价：$87,000 × (1 - 2%) = $85,260

### 场景2：下降趋势
- 入场价：$85,000
- 当前价：$83,000（下跌）
- 使用止损：4%
- 止损价：$85,000 × (1 - 4%) = $81,600（固定）

## 📊 与传统止损对比

| 对比项 | 传统止损 | 自适应止损 |
|--------|----------|------------|
| 止损百分比 | 固定不变 | 动态调整 |
| 上升趋势 | 2%止损 | 2%止损 |
| 下降趋势 | 2%止损 | 4%止损 |
| 利润保护 | 一般 | 更强 |
| 震荡容忍 | 低 | 高 |

## 💡 使用建议

1. **上升趋势**：适合使用较小的止损百分比，让利润奔跑
2. **下降趋势**：适合使用较大的止损百分比，避免被震荡洗出
3. **震荡行情**：自适应止损能更好地适应价格来回波动

## ⚠️ 注意事项

1. 确保 `STOP_LOSS_MODE=smart` 才能启用智能模式
2. 自适应止损只在智能模式下生效
3. 新仓位初始使用下降趋势的较大止损百分比
4. 严格遵循"只上涨不下降"原则

## 🎮 快速开始

1. 在 `.env` 文件中添加自适应止损配置
2. 设置合适的止损百分比（建议：上升2%，下降4%）
3. 确保 `ADAPTIVE_STOP_LOSS_ENABLED=true`
4. 重启交易机器人

系统会自动根据趋势调整止损策略，无需手动干预！